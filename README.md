# CodeCraft2023
2023华为软件精英挑战赛（成渝赛区）：无限进步

## 总结

止步初赛，成渝赛区太卷了！

- 受去年比赛的影响（Python转C++太苦了），我选择了使用C++语言进行编程，正确的选择！
- 因为去年的赛题是网络流，需要用到一些优化算法。因此在面对这次的题时就一直想着要找到一种优化方法，但最后还是以失败告终。今年的题其实要更工程化一些，考虑贪心算法其实就足够卷到310w+了。
- 要注重交流合作，可以适当地和其他选手讨论思路，互利共赢！
- 考虑泛化有些时候不一定是好的，可以针对不同问题（地图）针对性地制定策略。
- 热身赛不要每天一直沉浸于其中，注意劳逸结合也可以扩展思路。
- 好好学习，明年继续加油！！！

## 成绩

### 热身赛

| 日期   | 分数        | 说明                                   |
|------|-----------|--------------------------------------|
| 3.10 | 879,071   | baseline：实现基本行动与简单策略（距离最近）           |
| 3.11 | 1,710,141 | ①优化策略（不去买没人要的东西）；②优化机器人行走策略（先转再走，避免转圈） |
| 3.12 | 1,906,533 | 无显著优化                                |
| 3.13 | 2,695,439 | ①使用物理公式优化机器人行进；②优化策略，行进中一直检测是否可以去更好的地方 |
| 3.14 | 2,820,302 | 加入避障（墙壁和其他机器人）                       |
| 3.15 | 2,881,342 | 加入两机器人之间的优化（判断两机器人要去的地方可否交换）         |
| 3.16 | 2,650,793 | 一次决定买卖方式                             |

排名：57

### 正式赛 

| 日期 | 分数      | 说明                             |
| ---- | --------- | -------------------------------- |
| 3.25 | 2,784,550 | 对第1，3个地图进行针对性制定策略 |
| 3.26 | 2,902,126 | 对每个地图采用不同的策略         |

排名：70（排名刷新时间：2023-03-26 16:20:30）

## 基本定义

- Station：工作台
- Robot：机器人

## 基本思路

【注：以下解决思路是热身赛的思路，正式赛的路径规划和这个完全不同。正式赛思路见代码。】

将问题分为两大部分：机器人行走问题和机器人买卖策略。

### 机器人行走问题

根据题目含义，我们每一帧能控制机器人的预期角速度$[-\pi \sim \pi] \text{rad/s}$和预期前进速度$[-2 \sim 6] \text{m/s}$。

考虑其影响因素：

- 目的station的位置
- 自己当前的状态（朝向、角速度、线速度）
- 其他机器人的状态（避免碰撞）

#### 问题简化

已知在一个二维平面上，一圆形机器人的半径为$0.45\text{m}$，坐标为$(x_1, y_1)$，当前角速度为$w_0$，线速度为$\boldsymbol{v}_0$（矢量），如何控制机器人的预期角速度$\hat w$和预期前进速度$\hat v$来使其尽快且不停止地经过目的地（坐标为$(x_2, y_2)$，“经过”的判定条件是有一个时刻机器人中心与目的地间的距离小于$0.4\text{m}$）？。需要注意的是该环境尽量模拟了真实情况：机器人具有最大前进速度$6\text{m/s}$，最大后退速度$2\text{m/s}$，机器人密度$20\text{kg/m}^2$，最大旋转速度$\pi\text{/s}$，最大牵引力$250\text{N}$，最大力矩$50N\times m$。实际上，控制预期角速度和预期前进速度就是去控制牵引力和力矩。

#### 解决思路

首先仅考虑station的位置对角速度的影响。采用先转再走的形式，避免复杂的物理运算【TODO：让机器人不停止地进行运输】。具体实现上来说就是：如果station在robot的$\theta$角度上，那么如果$\text{abs}(\theta) \leq \pi / c_1$才移动，其他情况下不能移动（可以转向）。其中$c_1$是一个常数参数（代码中实现为8）。

考虑station的位置对前进速度的影响。速度先快后慢，速度计算公式如下：
$$
v = (1-e^{-d})v_{max}
$$
其中$d=((x_1-x_2)^2+(y_1 - y_2)^2)^{c_2}$，表示station和robot的距离。为了让距离远的时候可以更加快速，我们对$c_2$进行设定（欧式距离为$0.5$），代码中设为$0.8$。

### 机器人买卖策略

实际上就是选择4个robot到底谁去哪个station。

考虑其影响因素：

- station状态（坐标、剩余生产时间、原料状态、产品状态，确定`to_station`的考虑要不要换）
- robot状态（两个带着同样东西的robot不要去一个地方）

#### 问题简化

在一个二维地图上有四个机器人和一些工作台（可以购买和出售物品），你可以操纵这四个机器人前往工作台进行买卖操作。在这个过程中由于买卖价格不一样，机器人可以从中赚取利润，商品购买的价格是一定的，而出售的价格与持有时间和发生碰撞的程度有关，因此希望机器人能尽可能快并且不发生碰撞地进行移动。工作台有不同的类型，生产的物品有可能不同，出售价格不同，而且他们的生产还依赖于购买的材料，也就是说，工作台要进行生产必须保证有足够的原料。如何调度机器人前往不同的工作台（确定每个机器人前往工作台的序列）是非常重要的，你有什么想法吗？

#### 解决思路

当前买卖策略为：距离最近且可买（买了之后能卖出去）则去哪个station买；距离最近可以卖的地方。

## TODO

现在的策略还和robot的遍历有关，序号更前的可以更先被分配。这不一定合理。

精准预测时间：使用运动方程：速度、距离、朝向

【TODO】实现任务表，认领任务！

规则：

- 如果一个机器人卖给一个工作台后能直接把工作台的产品卖掉，那么就继续卖掉产品（相当于马上进入下一个任务）
- 如果一个机器人正在前往有产品的工作台，虽然可能只是去卖东西，但这个时候最好不要单独派一个机器人去专门执行这个任务。

【TODO】朝向加权距离，算出真实距离&时间。

### 各图分数分布（别人的）

| 1       | 2       | 3       | 4       |
| ------- | ------- | ------- | ------- |
| 670,000 | 850,000 | 870,000 | 610,000 |
| 660,000 | 750,000 | 920,000 | 660,000 |
| 693,426 | 754,379 | 909,767 | 686,533 |
| 700,000 | 800,000 | 900,000 | 800,000 |
| 730,966 | 817,720 | 983,026 | 670,992 |
| 760,000 | 930,000 | 990,000 | 640,000 |

### 我们的

| 日期           | 1       | 2       | 3       | 4       |
| -------------- | ------- | ------- | ------- | ------- |
| 3.24（线下）   | 623,408 | 586,428 | 892,987 | 567,319 |
| 3.24（线上）   | 604,661 | 748,912 | 869,731 | 561,246 |
| 3.25-1（线下） | 630,974 | 586,428 | 892,987 | 567,501 |
| 3.25-1（线上） | 637,518 | 748,912 | 869,731 | 628,075 |

