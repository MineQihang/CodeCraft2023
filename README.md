# CodeCraft2023
2023华为软件精英挑战赛（成渝赛区）：无限进步

## 成绩

| 日期 | 分数      | 说明                                                         |
| ---- | --------- | ------------------------------------------------------------ |
| 3.10 | 879,071   | baseline：实现基本行动与                                     |
| 3.11 | 1,710,141 | ①优化策略（不去买没人要的东西）；②优化机器人行走策略（先转再走，避免转圈） |
| 3.12 | 1,906,533 | 无显著优化                                                   |

## 基本定义

- Station：工作台
- Robot：机器人



## 基本思路

将问题分为两大部分：机器人行走问题和机器人买卖策略。

### 机器人行走问题

根据题目含义，我们每一帧能控制机器人的预期角速度$[-\pi \sim \pi] \text{rad/s}$和预期前进速度$[-2 \sim 6] \text{m/s}$。

考虑其影响因素：

- 目的station的位置
- 自己当前的状态（朝向、角速度、线速度）
- 其他机器人的状态（避免碰撞）

#### 问题简化

已知在一个二维平面上，一圆形机器人的半径为$0.45\text{m}$，坐标为$(x_1, y_1)$，当前角速度为$w_0$，线速度为$\boldsymbol{v}_0$（矢量），如何控制机器人的预期角速度$\hat w$和预期前进速度$\hat v$来使其尽快且不停止地经过目的地（坐标为$(x_2, y_2)$，“经过”的判定条件是有一个时刻机器人中心与目的地间的距离小于$0.4\text{m}$）？。需要注意的是该环境尽量模拟了真实情况：机器人具有最大前进速度$6\text{m/s}$，最大后退速度$2\text{m/s}$，机器人密度$20\text{kg/m}^2$，最大旋转速度$\pi\text{/s}$，最大牵引力$250\text{N}$，最大力矩$50N\times m$。实际上，控制预期角速度和预期前进速度就是去控制牵引力和力矩。

#### 解决思路

首先仅考虑station的位置对角速度的影响。采用先转再走的形式，避免复杂的物理运算【TODO：让机器人不停止地进行运输】。具体实现上来说就是：如果station在robot的$\theta$角度上，那么如果$\text{abs}(\theta) \leq \pi / c_1$才移动，其他情况下不能移动（可以转向）。其中$c_1$是一个常数参数（代码中实现为8）。

考虑station的位置对前进速度的影响。速度先快后慢，速度计算公式如下：
$$
v = (1-e^{-d})v_{max}
$$
其中$d=((x_1-x_2)^2+(y_1 - y_2)^2)^{c_2}$，表示station和robot的距离。为了让距离远的时候可以更加快速，我们对$c_2$进行设定（欧式距离为$0.5$），代码中设为$0.8$。



### 机器人买卖策略

实际上就是选择4个robot到底谁去哪个station。

考虑其影响因素：

- station状态（坐标、剩余生产时间、原料状态、产品状态，确定`to_station`的考虑要不要换）
- robot状态（两个带着同样东西的robot不要去一个地方）

#### 解决思路

当前买卖策略为：距离最近且可买（买了之后能卖出去）则去哪个station买；距离最近可以卖的地方。
